<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>El juego de la vida: Sonorización.</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>

<body>

    <!-- CSS (Estilos) -->
    <style>
        * {
            transition: all 0s;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            background: black;
        }

        td {
            border: rgb(0, 59, 77) solid 3px;
        }

        .contenedor-botones {
            position: fixed;
            top: 10px;
            right: 100px;
        }

        .btn {
            cursor: pointer;
            background: rgb(159, 164, 167);
            display: inline block;
            width: 45px;
            height: 45px;
            display: inline-flex;
            justify-content: center;
            align-items: center;
        }

        .btn:hover {
            background: black;
            color: white;
        }
    </style>

    <!-- HTML (Estructura) -->

    <div id="contenedor-tablero">
    </div>

    <div class="contenedor-botones">

        <div class="btn" id="btn1" onclick=" intercambiarReproducción()">
            <i class="fas fa-play" title="Iniciar"></i>
        </div>

        <div class="btn" id="btn2">
            <i class="fas fa-arrow-right" onclick="siguienteEstado()" title="Siguiente iteración"></i>
        </div>

        

        <div class="btn" id="btn4" onclick="randomizar()" title="Aleatorio">
            <i class="fas fa-dice"></i>
        </div>

        <div class="btn" id="btn3" onclick="limpiar()" title="Borrar">
            <i class="fas fa-eraser"></i>
        </div>

        <br>
        <br>

        <div class="btn" id="btn5" onclick="minus()" title="Alejarse">
            <i class="fas fa-minus"></i>
        </div>

        <div class="btn" id="btn6" onclick="plus()" title="Acercarse">
            <i class="fas fa-plus"></i>
        </div>

        
        <div class="btn" id="btn7" onclick="minusv()" title="Bajar volumen">
            <i class="fas fa-volume-down"></i>
        </div>

        <div class="btn" id="btn8" onclick="plusv()" title="Subir volumen">
            <i class="fas fa-volume-up"></i>
        </div>

        

       

        <br><br>

        <img src="underbanner juego de la vida.png" alt="conway underbanner">

        

        <!--<div class="btn" id="btn9" onclick="plust()" title="Desacelerar">
            <i class="fas fa-angle-right"></i>
        </div>

        <div class="btn" id="btn10" onclick="minust()" title="Acelerar">
            <i class="fas fa-angle-double-right"></i>
        </div> -->

       

        

    </div>

    <!-- JS (Lógica) -->
    <script>
        let filas = 8
        let columnas = 8
        let lado = 90
        var tempo = 15
        let volume = 5
        let positablero = 10
        

        let reproducir = false

        let fotografia = []

        let row1 = ["pluck 1,1.mp3","pluck 1,2.mp3","pluck 1,3.mp3","pluck 1,4.mp3","pluck 1,5.mp3","pluck 1,6.mp3","pluck 1,7.mp3","pluck 1,8.mp3"]
        let row2 = ["pluck 2,1.mp3","pluck 2,2.mp3","pluck 2,3.mp3","pluck 2,4.mp3","pluck 2,5.mp3","pluck 2,6.mp3","pluck 2,7.mp3","pluck 2,8.mp3"]
        let row3 = ["pluck 3,1.mp3","pluck 3,2.mp3","pluck 3,3.mp3","pluck 3,4.mp3","pluck 3,5.mp3","pluck 3,6.mp3","pluck 3,7.mp3","pluck 3,8.mp3"]
        let row4 = ["pluck 4,1.mp3","pluck 4,2.mp3","pluck 4,3.mp3","pluck 4,4.mp3","pluck 4,5.mp3","pluck 4,6.mp3","pluck 4,7.mp3","pluck 4,8.mp3"]
        let row5 = ["pluck 5,1.mp3","pluck 5,2.mp3","pluck 5,3.mp3","pluck 5,4.mp3","pluck 5,5.mp3","pluck 5,6.mp3","pluck 5,7.mp3","pluck 5,8.mp3"]
        let row6 = ["pluck 6,1.mp3","pluck 6,2.mp3","pluck 6,3.mp3","pluck 6,4.mp3","pluck 6,5.mp3","pluck 6,6.mp3","pluck 6,7.mp3","pluck 6,8.mp3"]
        let row7 = ["pluck 7,1.mp3","pluck 7,2.mp3","pluck 7,3.mp3","pluck 7,4.mp3","pluck 7,5.mp3","pluck 7,6.mp3","pluck 7,7.mp3","pluck 7,8.mp3"]
        let row8 = ["pluck 8,1.mp3","pluck 8,2.mp3","pluck 8,3.mp3","pluck 8,4.mp3","pluck 8,5.mp3","pluck 8,6.mp3","pluck 8,7.mp3","pluck 8,8.mp3"]

        let soundmatrix = [row1, row2, row3, row4, row5, row6, row7, row8]

        document.addEventListener("keydown", (e) => { //Para tener un control con el teclado
            e.preventDefault() //Para evitar el movimiento del scroll
            switch (e.keyCode) {
                case 39:
                    siguienteEstado()
                    break;
                case 68:
                    siguienteEstado()
                    break;    
                case 32:
                    intercambiarReproducción()
                    break;
                case 16:
                    limpiar()
                    break;
                case 82:
                    randomizar() 
                    break;   
                default:
                    break;
            }
        })
        function minust() {
            tempo--
            if (tempo<= 1) {
                tempo = 1
                return
            }
            console.log(tempo)
        }
        
        function plust() { 
            tempo++
            if (100 <= tempo) {
                tempo = 100
                return
            }
            console.log(tempo)
            
        } 


        setInterval(() => {
            if (reproducir) {
                siguienteEstado()
            }
        }, tempo*10);

        function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}



        function minusv() {
            volume--
            if (volume <= 0) {
                volume = 0
                return
            }
            
        }
        
        function plusv() { 
            volume++
            if (10 <= volume) {
                volume = 10
                return
            }
            
        } 

              


function playSound(x, y) {
  let rowx = soundmatrix[y]
  let selectedsound = rowx[x]   
  var audio = new Audio(selectedsound);
  var newvolume = volume
  audio.play();
  
  audio.volume = newvolume/10
}

async function demo() {
        console.log(`Waiting ${i} seconds...`);
        await sleep(tiempito*50);
    
    console.log('Done');
}

        function centrar() {
            window.scrollTo(
                (lado * columnas - window.innerWidth) / 2,
                (lado * filas - window.innerHeight) / 2
            )
        }
        

        function minus() {
            lado--
            if (lado <= 7) {
                lado = 7
                return
            }
            let tablero = document.getElementById("tablero")
            tablero.style.width = lado * columnas + "px"
            tablero.style.height = lado * filas + "px"
        }

        function plus() {
            lado++
            let tablero = document.getElementById("tablero")
            tablero.style.width = lado * columnas + "px"
            tablero.style.height = lado * filas + "px"
        }
       function randomizar() {
            mapa_complejidad = []
            for (let x = 0; x < columnas; x++) {
                for (let y = 0; y < filas; y++) {
                    if (Math.random() < 0.2) {
                        cambiarEstado(x, y)
                    }
                }
            }
        }

        function intercambiarReproducción() {
            mapa_complejidad = []
            reproducir = !reproducir
            if (reproducir) {
                document.body.style.background = "black"
                document.getElementById("btn1").innerHTML = `<i class="fas fa-pause"></i>`
            } else {
                document.body.style.background = "black"
                document.getElementById("btn1").innerHTML = `<i class="fas fa-play"></i>`
            }
        }

        generarTablero()
        

        function generarTablero() {
            let html = "<table cellpadding=0 cellspacing=0 id='tablero'>"
            for (let y = 0; y < filas; y++) {
                html += "<tr>"
                for (let x = 0; x < columnas; x++) {
                    html += `<td id="celula-${x + "-" + y}" onmouseup="cambiarEstado(${x}, ${y});mapa_complejidad = []">`
                    html += "</td>"
                }
                html += "</tr>"
            }
            html += "</table>"
            let contenedor = document.getElementById("contenedor-tablero")
            contenedor.innerHTML = html
            let tablero = document.getElementById("tablero")
            tablero.style.width = lado * columnas + "px"
            tablero.style.height = lado * filas + "px"
            centrar()
        }

        function cambiarEstado(x, y) {
            let celula = document.getElementById(`celula-${x + "-" + y}`)
            if (celula.style.background != "white") {
                celula.style.background = "white"
                
            } else {
                celula.style.background = ""
            }
        }

        function limpiar() {
            mapa_complejidad = []
            for (let x = 0; x < columnas; x++) {
                for (let y = 0; y < filas; y++) {
                    let celula = document.getElementById(`celula-${x + "-" + y}`)
                    celula.style.background = ""
                }
            }
            if (reproducir) {
                intercambiarReproducción()
            }
        }

        let mapa_complejidad = []
        let p_mapa_complejidad = []
        let mapa_verificados = []

        function fotografiar() {
            p_mapa_complejidad = JSON.parse(JSON.stringify(mapa_complejidad));
            mapa_complejidad = []
            mapa_verificados = []
            fotografia = []
            if (!p_mapa_complejidad.length) {
                primeraFoto()
            } else {
                demasFotos()
            }
        }


        function demasFotos() {
            for (let x in p_mapa_complejidad) {
                for (let y in p_mapa_complejidad[x]) {
                    try {
                        let celula = document.getElementById(`celula-${x + "-" + y}`)
                        if (!fotografia[x]) {
                            fotografia[x] = []
                            mapa_verificados[x] = []
                        }
                        fotografia[x][y] = celula.style.background == "white"
                        calcularMapaComplejidad(Number(x), Number(y))
                    } catch (e) { }
                }
            }
            p_mapa_complejidad = []
        }

        function primeraFoto() {
            for (let x = 0; x < columnas; x++) {
                fotografia.push([])
                mapa_verificados.push([])
                for (let y = 0; y < filas; y++) {
                    let celula = document.getElementById(`celula-${x + "-" + y}`)
                    fotografia[x][y] = celula.style.background == "white"
                    calcularMapaComplejidad(x, y)
                }
            }
        }

        function calcularMapaComplejidad(x, y) {
            if (fotografia[x][y]) {
                for (let i = -1; i <= 1; i++) {
                    for (let j = -1; j <= 1; j++) {
                        if (!mapa_complejidad[(((x+i)%8)+8)%8]) {
                            mapa_complejidad[(((x+i)%8)+8)%8] = []
                        }
                        mapa_complejidad[(((x+i)%8)+8)%8][(((y+j)%8)+8)%8] = true
                    }
                }
            }
        }

        function contarVivas(x, y) {
            let vivas = 0
            for (let i = -1; i <= 1; i++) {
                for (let j = -1; j <= 1; j++) {
                    if (i == 0 && j == 0) {
                        continue
                    }                   
                    try {
                        if (fotografia[(((x+i)%8)+8)%8][(((y + j)%8)+8)%8]) {
                            vivas++
                        }
                    } catch (e) { }
                    if (vivas > 3) {
                        return vivas
                    }
                }
            }
            return vivas
        }

        

        function siguienteEstado() {
            fotografiar()
            for (const x in mapa_complejidad) {
                for (const y in mapa_complejidad[x]) {
                    try {
                        if (mapa_verificados[x][y]) {
                            continue
                        }
                        mapa_verificados[x][y] = true

                        let vivas = contarVivas(Number(x), Number(y))
                        let celula = document.getElementById(`celula-${x + "-" + y}`)
                        if (fotografia[x][y]) { //celula está viva
                            if (vivas < 2 || vivas > 3) {
                                celula.style.background = "" // Muere por sobrepoblación o soledad
                                playSound(x,y)
                               
            
                            }
                        } else { //celula está muerta
                            if (vivas == 3)
                                celula.style.background = "white"
                                
                        }
                    } catch (e) { }
                }
            }
        }

    




        
    </script>

</body>

</html>